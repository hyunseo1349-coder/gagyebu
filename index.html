<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Smart Ledger 2026 Pro</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* [ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€ ë° ê°œì„ ] */
    :root { --primary: #6366F1; --bg: #F9FAFB; --danger: #EF4444; --success: #10B981; }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: 'Noto Sans KR', sans-serif; background: var(--bg); color: #1F2937; line-height: 1.5; }
    
    .header { display: flex; justify-content: space-between; align-items: center; padding: 16px 24px; background: white; border-bottom: 1px solid #E5E7EB; position: sticky; top: 0; z-index: 100; }
    .view-toggle { display: flex; background: #F3F4F6; padding: 4px; border-radius: 12px; }
    .view-toggle button { padding: 8px 24px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600; transition: 0.2s; }
    .view-toggle button.active { background: white; color: var(--primary); shadow: 0 2px 4px rgba(0,0,0,0.1); }

    .main { max-width: 900px; margin: 0 auto; padding: 24px; }
    
    /* ëŒ€ì‹œë³´ë“œ ì¹´ë“œ */
    .summary-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 32px; }
    .card { background: white; padding: 20px; border-radius: 20px; border: 1px solid #E5E7EB; box-shadow: 0 4px 6px rgba(0,0,0,0.02); }
    .card-label { font-size: 13px; color: #6B7280; display: block; margin-bottom: 8px; }
    .card-value { font-size: 20px; font-weight: 700; }

    /* í•˜ë‹¨ ë„¤ë¹„ê²Œì´ì…˜ ë° í•„í„° */
    .list-controls { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; background: white; padding: 16px; border-radius: 16px; border: 1px solid #E5E7EB; }
    .nav-group { display: flex; align-items: center; gap: 12px; }
    .nav-btn { width: 32px; height: 32px; border: 1px solid #E5E7EB; background: white; border-radius: 8px; cursor: pointer; }
    .nav-btn:disabled { opacity: 0.3; cursor: not-allowed; }
    .current-period { font-weight: 700; font-size: 16px; min-width: 100px; text-align: center; }

    /* ë¹ ë¥¸ ì…ë ¥ ì„¹ì…˜ */
    .quick-input-area { background: white; border-radius: 20px; padding: 24px; margin-bottom: 32px; border: 1px solid #E5E7EB; }
    .btn-group { display: flex; gap: 10px; margin-top: 15px; }
    .btn { padding: 12px 20px; border-radius: 12px; border: none; cursor: pointer; font-weight: 600; font-size: 14px; }
    .btn-outline { background: #F3F4F6; color: #4B5563; }
    .btn-primary { background: var(--primary); color: white; flex: 1; }
    
    textarea { width: 100%; height: 80px; padding: 15px; border-radius: 12px; border: 1px solid #E5E7EB; background: #F9FAFB; resize: none; font-family: inherit; }

    /* ì •ì‚° ê²€ì¦ ìŠ¤íƒ€ì¼ */
    .validate-badge { font-size: 11px; padding: 2px 6px; border-radius: 4px; margin-left: 8px; }
    .bad { background: #FEE2E2; color: #EF4444; }
    .good { background: #D1FAE5; color: #059669; }

    /* ëª¨ë‹¬ */
    .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; backdrop-filter: blur(4px); }
    .modal-overlay.active { display: flex; }
    .modal { background: white; border-radius: 24px; width: 90%; max-width: 500px; padding: 24px; max-height: 90vh; overflow-y: auto; }
    
    .preview-table { width: 100%; border-collapse: collapse; margin-top: 15px; font-size: 13px; }
    .preview-table th { text-align: left; padding: 8px; background: #F3F4F6; }
    .preview-table td { padding: 8px; border-bottom: 1px solid #F3F4F6; }

    .fab { position: fixed; bottom: 24px; right: 24px; width: 60px; height: 60px; border-radius: 30px; background: var(--primary); color: white; border: none; font-size: 24px; box-shadow: 0 4px 15px rgba(99,102,241,0.4); cursor: pointer; }

    @media (max-width: 600px) {
      .summary-grid { grid-template-columns: 1fr; }
      .list-controls { flex-direction: column; gap: 15px; }
    }
  </style>
</head>
<body>

  <header class="header">
    <div style="font-weight: 800; color: var(--primary); font-size: 20px;">Smart Ledger</div>
    <div class="view-toggle">
      <button id="btn-monthly" class="active" onclick="setView('monthly')">ì›”ê°„</button>
      <button id="btn-yearly" onclick="setView('yearly')">ì—°ê°„</button>
    </div>
  </header>

  <main class="main">
    <div class="summary-grid" id="summaryGrid">
      <div class="card">
        <span class="card-label">ì´ ì§€ì¶œ</span>
        <span class="card-value" id="stat-total">0ì›</span>
      </div>
      <div class="card">
        <span class="card-label">ğŸ’° ë‚´ ì‹¤ì œ ë¶€ë‹´</span>
        <span class="card-value" id="stat-my">0ì›</span>
      </div>
      <div class="card">
        <span class="card-label">âœˆï¸ ë§ˆì¼ë¦¬ì§€ ì ë¦½</span>
        <span class="card-value" id="stat-mile">0 ë§ˆì¼</span>
      </div>
    </div>

    <div class="quick-input-area" id="quickInputArea">
      <div style="margin-bottom: 12px;">
        <h3 style="font-size: 16px;">ë¹ ë¥¸ ì…ë ¥</h3>
        <p style="font-size: 12px; color: #6B7280;">ì¹´ë“œ ê²°ì œ ë¬¸ìë¥¼ ì—¬ëŸ¬ ì¤„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”.</p>
      </div>
      <textarea id="rawInput" placeholder="[ì‹ í•œì²´í¬] 01/25 14:20 12,500ì› ìŠ¤íƒ€ë²…ìŠ¤"></textarea>
      <div class="btn-group">
        <button class="btn btn-outline" onclick="openManualModal()">âœï¸ ì§ì ‘ ì…ë ¥</button>
        <button class="btn btn-primary" onclick="parseAndPreview()">âœ¨ ìë™ íŒŒì‹± ë° ì¶”ê°€</button>
      </div>
    </div>

    <div class="list-controls">
      <div class="nav-group">
        <button class="nav-btn" id="prevBtn" onclick="changePeriod(-1)">â—€</button>
        <span class="current-period" id="periodDisplay">2026ë…„ 1ì›”</span>
        <button class="nav-btn" id="nextBtn" onclick="changePeriod(1)">â–¶</button>
      </div>
      <div id="filterGroup">
        <label style="font-size: 13px;"><input type="checkbox" id="gcHide" onchange="render()"> ìƒí’ˆê¶Œ ì œì™¸</label>
      </div>
    </div>

    <div id="listArea"></div>
  </main>

  <div class="modal-overlay" id="previewModal">
    <div class="modal">
      <h3 style="margin-bottom:15px">íŒŒì‹± ê²°ê³¼ ë¯¸ë¦¬ë³´ê¸°</h3>
      <div style="overflow-x: auto;">
        <table class="preview-table">
          <thead><tr><th>ë‚ ì§œ</th><th>ê°€ë§¹ì </th><th>ê¸ˆì•¡</th><th>ì¹´ë“œ</th></tr></thead>
          <tbody id="previewBody"></tbody>
        </table>
      </div>
      <div class="btn-group" style="margin-top:20px">
        <button class="btn btn-outline" onclick="closeModal('previewModal')">ì·¨ì†Œ</button>
        <button class="btn btn-primary" onclick="confirmQuickInput()">ëª¨ë‘ ì €ì¥í•˜ê¸°</button>
      </div>
    </div>
  </div>

  <button class="fab" onclick="openManualModal()">+</button>

  <script>
    /* ==========================================
       1. ì´ˆê¸° ìƒíƒœ ë° í™˜ê²½ ì„¤ì •
    ========================================== */
    const START_YEAR = 2026;
    const START_MONTH = 1;
    
    // ì‚¬ìš©ìë³„ ë°ì´í„° ë¶„ë¦¬ë¥¼ ìœ„í•´ ë¡œì»¬ìŠ¤í† ë¦¬ì§€ í‚¤ì— ê³ ìœ  ID í™œìš© (ì—†ìœ¼ë©´ ìƒì„±)
    if(!localStorage.getItem('sl_user_id')) localStorage.setItem('sl_user_id', 'user_' + Math.random().toString(36).substr(2, 9));
    const USER_KEY = `sl_data_${localStorage.getItem('sl_user_id')}`;

    let state = {
      view: 'monthly', // 'monthly' | 'yearly'
      year: 2026,
      month: 1,
      data: JSON.parse(localStorage.getItem(USER_KEY)) || { transactions: [], mileData: {} },
      tempQuick: []
    };

    /* ==========================================
       2. í•µì‹¬ ê¸°ëŠ¥: ë°ì´í„° ì €ì¥ ë° ë Œë”ë§
    ========================================== */
    function saveData() {
      localStorage.setItem(USER_KEY, JSON.stringify(state.data));
    }

    function setView(v) {
      state.view = v;
      document.getElementById('btn-monthly').classList.toggle('active', v === 'monthly');
      document.getElementById('btn-yearly').classList.toggle('active', v === 'yearly');
      render();
    }

    function changePeriod(dir) {
      if (state.view === 'monthly') {
        state.month += dir;
        if (state.month > 12) { state.month = 1; state.year++; }
        if (state.month < 1) { state.month = 12; state.year--; }
      } else {
        state.year += dir;
      }
      
      // 2026ë…„ 1ì›” ì´ì „ ì œí•œ
      if (state.year < START_YEAR) state.year = START_YEAR;
      if (state.year === START_YEAR && state.month < START_MONTH) state.month = START_MONTH;
      
      render();
    }

    function render() {
      // 1. ê¸°ê°„ í‘œì‹œ ì—…ë°ì´íŠ¸
      const periodDisp = document.getElementById('periodDisplay');
      periodDisp.textContent = state.view === 'monthly' ? `${state.year}ë…„ ${state.month}ì›”` : `${state.year}ë…„`;
      
      // 2. ë²„íŠ¼ í™œì„±í™” ì œì–´
      const isStart = (state.year === START_YEAR && (state.view === 'yearly' || state.month === START_MONTH));
      document.getElementById('prevBtn').disabled = isStart;

      // 3. ë°ì´í„° í•„í„°ë§ ë° í†µê³„ ê³„ì‚°
      const hideGC = document.getElementById('gcHide').checked;
      let filtered = state.data.transactions.filter(t => {
        const d = new Date(t.fullDate);
        const yMatch = d.getFullYear() === state.year;
        const mMatch = state.view === 'monthly' ? (d.getMonth() + 1) === state.month : true;
        const gcMatch = hideGC ? t.category !== 'giftcard' : true;
        return yMatch && mMatch && gcMatch;
      });

      // ì •ë ¬ (ìµœì‹ ìˆœ)
      filtered.sort((a, b) => new Date(b.fullDate) - new Date(a.fullDate));

      let total = 0, myTotal = 0;
      filtered.forEach(t => {
        total += t.amount;
        myTotal += (t.split && t.split.enabled) ? t.split.me : t.amount;
      });

      // í†µê³„ UI ì—…ë°ì´íŠ¸
      document.getElementById('stat-total').textContent = total.toLocaleString() + 'ì›';
      document.getElementById('stat-my').textContent = Math.floor(myTotal).toLocaleString() + 'ì›';
      
      // 4. ë¦¬ìŠ¤íŠ¸ ìƒì„±
      const listArea = document.getElementById('listArea');
      if (filtered.length === 0) {
        listArea.innerHTML = `<div style="text-align:center; padding:40px; color:#9CA3AF;">ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
      } else {
        listArea.innerHTML = filtered.map(t => `
          <div class="card" style="margin-bottom:10px; display:flex; justify-content:space-between; align-items:center;">
            <div>
              <div style="font-size:12px; color:#9CA3AF;">${t.fullDate.substring(5)} | ${t.card}</div>
              <div style="font-weight:600;">${t.store}</div>
            </div>
            <div style="text-align:right">
              <div style="font-weight:700;">${t.amount.toLocaleString()}ì›</div>
              <div style="font-size:11px; color:var(--primary)">${t.category === 'giftcard' ? 'ğŸ« ìƒí’ˆê¶Œ' : 'ğŸ›’ ì¼ë°˜'}</div>
            </div>
          </div>
        `).join('');
      }
    }

    /* ==========================================
       3. ì§€ëŠ¥í˜• íŒŒì‹± (SMS/ì¹´í†¡ ìë™ì¸ì‹)
    ========================================== */
    function parseAndPreview() {
      const text = document.getElementById('rawInput').value.trim();
      if(!text) return alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");

      const lines = text.split('\n');
      state.tempQuick = [];

      lines.forEach(line => {
        // [ê¸ˆì•¡ ì¶”ì¶œ] ìˆ«ìì™€ ì½¤ë§ˆ ì¡°í•©
        const amountMatch = line.replace(/,/g, '').match(/\d{3,9}/);
        const amount = amountMatch ? parseInt(amountMatch[0]) : 0;

        // [ë‚ ì§œ ì¶”ì¶œ] MM/DD ë˜ëŠ” MM-DD
        const dateMatch = line.match(/(\d{1,2})[\/\-.](\d{1,2})/);
        let dateStr = `${state.year}-${String(state.month).padStart(2,'0')}-01`;
        if(dateMatch) {
          dateStr = `${state.year}-${String(dateMatch[1]).padStart(2,'0')}-${String(dateMatch[2]).padStart(2,'0')}`;
        }

        // [ì¹´ë“œì‚¬ ì¶”ì¶œ]
        const cards = ['ì‹ í•œ', 'ìš°ë¦¬', 'ì‚¼ì„±', 'í˜„ëŒ€', 'êµ­ë¯¼', 'ë†í˜‘', 'ë¡¯ë°', 'ì¹´ì¹´ì˜¤'];
        const card = cards.find(c => line.includes(c)) || 'ê¸°íƒ€';

        // [ê°€ë§¹ì ] ê¸ˆì•¡ ë’¤ì— ì˜¤ëŠ” ë¬¸ìì—´ í˜¹ì€ ë§ˆì§€ë§‰ ë‹¨ì–´
        let store = "ì•Œ ìˆ˜ ì—†ìŒ";
        const parts = line.split(/\s+/);
        if(parts.length > 2) store = parts[parts.length - 1];

        if(amount > 0) {
          state.tempQuick.push({
            id: Date.now() + Math.random(),
            fullDate: dateStr,
            store: store,
            amount: amount,
            card: card,
            category: line.includes('ìƒí’ˆê¶Œ') ? 'giftcard' : 'etc',
            split: { enabled: false }
          });
        }
      });

      if(state.tempQuick.length === 0) return alert("ì¸ì‹ ê°€ëŠ¥í•œ ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.");

      // ë¯¸ë¦¬ë³´ê¸° ëª¨ë‹¬ ë„ìš°ê¸°
      const tbody = document.getElementById('previewBody');
      tbody.innerHTML = state.tempQuick.map(t => `
        <tr>
          <td>${t.fullDate.substring(5)}</td>
          <td>${t.store}</td>
          <td>${t.amount.toLocaleString()}ì›</td>
          <td>${t.card}</td>
        </tr>
      `).join('');
      
      document.getElementById('previewModal').classList.add('active');
    }

    function confirmQuickInput() {
      state.data.transactions.push(...state.tempQuick);
      saveData();
      state.tempQuick = [];
      document.getElementById('rawInput').value = '';
      closeModal('previewModal');
      render();
    }

    /* ==========================================
       4. ìœ í‹¸ë¦¬í‹° ë° ê¸°íƒ€
    ========================================== */
    function closeModal(id) { document.getElementById(id).classList.remove('active'); }
    function openManualModal() { alert("ì§ì ‘ ì…ë ¥ ê¸°ëŠ¥ì€ 'ë¹ ë¥¸ ì…ë ¥'ì˜ íŒŒì‹± ì„±ëŠ¥ ê³ ë„í™” ì´í›„ í†µí•© ì˜ˆì •ì…ë‹ˆë‹¤. í˜„ì¬ëŠ” ë¬¸ìë¥¼ ë³µì‚¬í•´ ë„£ëŠ” ë°©ì‹ì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤!"); }

    // ì´ˆê¸° ì‹¤í–‰
    render();
  </script>
</body>
</html>
